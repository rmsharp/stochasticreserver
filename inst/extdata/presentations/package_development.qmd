---
title: "stochasticreserver: Journey to CRAN Readiness"
author: "R. Mark Sharp"
date: "January 21, 2026"
format:
  revealjs:
    theme: default
    slide-number: true
    smaller: true
    scrollable: true
    code-fold: false
    highlight-style: github
---

## Package Overview

### stochasticreserver

A **Flexible Framework for Stochastic Reserving Models**

- Implements maximum likelihood estimators for actuarial reserving
- Handles non-linear reserving models directly
- No transformation needed for linear/GLM methods
- Unified framework for five common reserving methods

**Based on:** Roger Hayne's paper in *Variance* journal

---

## The Five Reserving Methods

| Method | Description |
|--------|-------------|
| **Berquist** | Berquist-Sherman Incremental Severity |
| **CapeCod** | Cape Cod (Bornhuetter-Ferguson variant) |
| **Chain** | Chain Ladder method |
| **Hoerl** | Generalized Hoerl Curve with Trend |
| **Wright** | Generalized Hoerl with Individual AY Levels |

All methods share a common statistical framework using maximum likelihood
estimation.

---

## Two-Day Transformation

**Transform the package for CRAN submission**

### Session 1 (January 20, 2026):
- Add code quality tools (covr, lintr)
- Write comprehensive unit tests
- Fix all CRAN check issues
- Add GitHub Actions CI/CD

### Session 2 (January 21, 2026):
- Create TDD contract (CLAUDE.md)
- Hayne paper reproduction vignette
- Comprehensive lint fixes

---

## Transformation Results

### Before vs After

| Metric | Before | After |
|--------|--------|-------|
| Test Coverage | 7.23% | **98.81%** |
| Unit Tests | 4 | **158** |
| R CMD check NOTEs | 6 | **2** |
| Lint Errors | 2,598 | **122** |
| Line Length Limit | None | **80 chars** |
| testthat Edition | 2 | **3** |
| Working URLs | No | **Yes** |

---

## Test Coverage Achieved

### Overall Coverage: **98.81%**

```{r}
#| echo: false
#| fig-height: 4
coverage_data <- data.frame(
  File = c("capecod", "chain", "hoerl", "wright",
           "get_incr", "gradient", "hessian", "likelihood",
           "berquist", "model_desc"),
  Coverage = c(100, 100, 100, 100, 100, 100, 100, 100, 91, 90)
)
barplot(coverage_data$Coverage,
        names.arg = coverage_data$File,
        col = ifelse(coverage_data$Coverage == 100, "green", "yellow"),
        main = "Code Coverage by File",
        ylab = "Percent Coverage",
        ylim = c(0, 100),
        las = 2,
        cex.names = 1.1,
        cex.lab = 1.3,
        cex.axis = 1.1)
abline(h = 80, col = "blue", lty = 2)
```

---

## Test Suite Growth

### 4 → 158 Tests Across Development

| Milestone | Tests | Coverage |
|-----------|-------|----------|
| Initial state | 4 | 7.23% |
| After Request 5 | 85 | 98.81% |
| After Request 16 | 93 | 98.81% |
| After Request 17 (TDD vignette) | **158** | 98.81% |

**Test files:** 10 comprehensive test files

---

## TDD Contract (Session 2)

### Created CLAUDE.md

Strict RED/GREEN/REFACTOR phases:

1. **RED Phase:** Write failing tests first
   - No implementation code allowed
   - Tests define requirements

2. **GREEN Phase:** Minimal code to pass
   - Only enough to make tests green
   - No over-engineering

3. **REFACTOR Phase:** Improve while green
   - Clean up code
   - Keep all tests passing

---

## Hayne Paper Vignette (TDD)

### Created hayne_paper_reproduction.qmd

**30 tests written FIRST** covering:

- Quarto YAML header structure
- Theoretical framework section
- All five model sections
- Mathematical equations (LaTeX)
- Gradient and Hessian discussion
- Fisher information coverage
- Package data usage
- Tables and figures
- Model comparison section
- Simulation/uncertainty analysis

---

## Vignette Contents

### Reproduces Key Results from Hayne Paper

| Section | Content |
|---------|---------|
| Theoretical Framework | MLE, likelihood structure |
| Data | Table 1 triangle with proper labels |
| Chain Ladder | Fit, parameters, reserves |
| Cape Cod | Fit, parameters, reserves |
| Berquist-Sherman | Fit, parameters, reserves |
| Hoerl | Fit, parameters, reserves |
| Wright | Fit, parameters, reserves |
| Comparison | AIC/BIC, residuals, simulation |

---

## CRAN Issues Fixed (1/2)

### DESCRIPTION Cleanup
- Removed `DisplayMode: Showcase` field
- Fixed Authors@R format
- Updated RoxygenNote to 7.3.3
- Added testthat edition 3

---

## CRAN Issues Fixed (2/2)

### URL Fixes
- Updated broken variancejournal.org links
- All documentation now uses working URLs

### LICENSE Fix
- Changed to proper DCF format
- Updated copyright years (2017-2026)

---

## Lint Error Reduction

### 2,598 → 122 Errors

| Linter | Fixed | Remaining |
|--------|-------|-----------|
| assignment_linter | ✓ All | 0 |
| brace_linter | ✓ All | 0 |
| return_linter | ✓ All | 0 |
| seq_linter | ✓ All | 0 |
| line_length_linter | ✓ All | 0 |
| object_name_linter | Intentional | 97 |
| indentation_linter | Minor | 25 |

**Note:** Remaining are mathematical notation (B0, A0, E)

---

## Code Style Updates

### Changes Made

- `=` → `<-` for all assignments
- Proper brace style for if/else
- Removed explicit `return()` statements
- `1:length()` → `seq_along()`
- All lines ≤ 80 characters
- Removed trailing blank lines

### .lintr Configuration
```yaml
linters: linters_with_defaults(
    line_length_linter(80),
    object_name_linter(styles = c("snake_case",
      "symbols", "camelCase", "dotted.case"))
  )
```

---

## R CMD check Results

### Final Status: **2 NOTEs** (No ERRORs or WARNINGs)

| NOTE | Description | Status |
|------|-------------|--------|
| 1 | New submission | Expected |
| 2 | HTML Tidy validation | System issue |

**Package is CRAN ready!**

---

## GitHub Actions CI/CD

### 5 Automated Workflows

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| R-CMD-check | Push/PR | Multi-platform testing |
| R-CMD-check-scheduled | Monday 9:00 UTC | Catch dependency changes |
| test-coverage | Push/PR | Codecov reporting |
| pkgdown | Push/PR/Release | Documentation site |
| lint | Push/PR | Code quality |

**All workflows passing ✓**

---

## CI/CD Testing Matrix

### R-CMD-check runs on:

- **macOS** (latest) - R release
- **Windows** (latest) - R release
- **Ubuntu** (latest) - R devel, release, oldrel-1

All platforms must pass for merge.

---

## Codecov Integration

### Coverage Tracking

- **codecov.yml** configuration added
- Coverage precision: 2 decimal places
- Threshold: 1% tolerance
- PR comments show coverage diff

**Live dashboard:**
[app.codecov.io/gh/rmsharp/stochasticreserver](https://app.codecov.io/gh/rmsharp/stochasticreserver)

---

## Documentation Site

### pkgdown at GitHub Pages

**Features:**

- Automatic deployment on push
- Function reference organized by category
- Vignettes as Articles
- Code folding (custom JavaScript)
- Bootstrap 5 theme

**URL:** [rmsharp.github.io/stochasticreserver](https://rmsharp.github.io/stochasticreserver/)

---

## Vignettes Available

### Three Comprehensive Guides

| Vignette | Description |
|----------|-------------|
| **Comprehensive Tutorial** | All 5 models with examples |
| **Hayne Paper Reproduction** | Full paper replication |
| **Stochastic Reserving** | Original technical vignette |

**Features:**

- Code folding - click to expand
- Mathematical equations
- Interactive tables and plots

---

## Bugs Fixed During Development

### Code Quality Improvements

| File | Issue | Fix |
|------|-------|-----|
| model_description.R | Duplicate "CapeCod" | Changed to "Chain" |
| berquist.R | Wrong error message | "(size - 1)" → "(size + 1)" |
| berquist.R | Dead code (trd) | Commented with note |
| chain.R | Unused variable d3 | Commented with note |

---

## Session 1 Commits (Jan 20)

| Commit | Description |
|--------|-------------|
| faba7f4 | Comprehensive tests, CRAN fixes |
| 525b777 | Code folding JavaScript |
| 8dad67f | Codecov configuration |
| 0ee43db | CAS PDF link |
| 638c078 | Fix model_description |
| 62d1ae3 | Fix berquist bugs |

---

## Session 2 Commits (Jan 21)

| Commit | Description |
|--------|-------------|
| 92cf809 | Fix vignette path for R CMD check |
| 9cd9aa8 | Fix vignette build for pkgdown |
| 365e00d | Fix Table 1 formatting |
| e9d4681 | Add vignette to lintr exclusions |
| 85bba0b | Fix assignment_linter errors |
| 3fcf4f7 | Fix brace, seq, return linter errors |
| 954b13e | Fix line_length_linter errors |
| d110e24 | Comment out unused d3 variable |
| e873b27 | Update INTERACTIONS_LOG |

---

## Package Structure

```
stochasticreserver/
├── R/
│   ├── berquist.R, capecod.R, chain.R
│   ├── hoerl.R, wright.R
│   ├── make_*.R (3 files)
│   └── model_description.R
├── tests/testthat/
│   └── test_*.R (10 files, 158 tests)
├── vignettes/
│   ├── comprehensive_tutorial.Rmd
│   ├── hayne_paper_reproduction.qmd
│   └── stochastic_reserving.Rmd
├── inst/extdata/presentations/
└── DESCRIPTION, LICENSE, README, CLAUDE.md
```

---

## Summary

### Package Transformation Complete

::: {.incremental}
- **Coverage:** 7% → 99%
- **Tests:** 4 → 158
- **NOTEs:** 6 → 2
- **Lint Errors:** 2,598 → 122
- **Style:** Modern R best practices
- **TDD:** Contract established
- **Status:** CRAN Ready
:::

---

## Resources

### Package Links

- **Repository:** [github.com/rmsharp/stochasticreserver
](https://github.com/rmsharp/stochasticreserver)
- **Documentation:** [rmsharp.github.io/stochasticreserver
](https://rmsharp.github.io/stochasticreserver/)

### Reference

Hayne, R. "A Flexible Framework for Stochastic Reserving Models"
*Variance*, Vol 7, Issue 2

[variancejournal.org/article/120823](https://variancejournal.org/article/120823)

---

## Thank You

### Sessions documented in:

`INTERACTIONS_LOG.md`

All prompts and actions recorded for reproducibility.

**Development approach:** Test-Driven Development (TDD)
