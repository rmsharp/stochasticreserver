---
title: "stochasticreserver: Journey to CRAN Readiness"
author: "R. Mark Sharp"
date: "January 20, 2026"
format:
  revealjs:
    theme: default
    slide-number: true
    smaller: true
    scrollable: true
    code-fold: false
    highlight-style: github
---

## Package Overview

### stochasticreserver

A **Flexible Framework for Stochastic Reserving Models**

- Implements maximum likelihood estimators for actuarial reserving
- Handles non-linear reserving models directly
- No transformation needed for linear/GLM methods
- Unified framework for five common reserving methods

**Based on:** Roger Hayne's paper in *Variance* journal

---

## The Five Reserving Methods

| Method | Description |
|--------|-------------|
| **Berquist** | Berquist-Sherman method |
| **CapeCod** | Cape Cod (Bornhuetter-Ferguson variant) |
| **Chain** | Chain Ladder method |
| **Hoerl** | Hoerl curve method |
| **Wright** | Wright method |

All methods share a common statistical framework using maximum likelihood
estimation.

---

## Session Goals

**Transform the package for CRAN submission**

Tasks accomplished:

1. Add code quality tools (covr, lintr)
2. Write comprehensive unit tests
3. Fix all CRAN check issues
4. Update code style to 80 character limit
5. Commit and push changes

---

## Transformation Results

### Before vs After

| Metric | Before | After |
|--------|--------|-------|
| Test Coverage | 7.23% | **98.81%** |
| Unit Tests | 4 | **85** |
| R CMD check NOTEs | 6 | **2** |
| Line Length Limit | None | **80 chars** |
| testthat Edition | 2 | **3** |
| Working URLs | No | **Yes** |

---

## Test Coverage Achieved

### Overall Coverage: **98.81%**

```{r}
#| echo: false
#| fig-height: 4
coverage_data <- data.frame(
  File = c("capecod", "chain", "hoerl", "wright",
           "get_incr", "gradient", "hessian", "likelihood",
           "berquist", "model_desc"),
  Coverage = c(100, 100, 100, 100, 100, 100, 100, 100, 91, 90)
)
barplot(coverage_data$Coverage,
        names.arg = coverage_data$File,
        col = ifelse(coverage_data$Coverage == 100, "green", "yellow"),
        main = "Code Coverage by File",
        ylab = "Percent Coverage",
        ylim = c(0, 100),
        las = 2,
        cex.names = 1.1,
        cex.lab = 1.3,
        cex.axis = 1.1)
abline(h = 80, col = "blue", lty = 2)
```

---

## Comprehensive Test Suite

### 85 Tests Across 10 Test Files

| Test File | Tests | Coverage |
|-----------|-------|----------|
| test_capecod.R | 6 | 100% |
| test_chain.R | 9 | 100% |
| test_hoerl.R | 8 | 100% |
| test_wright.R | 7 | 100% |
| test_model_description.R | 6 | 90% |
| test_make_negative_log_likelihood.R | 3 | 100% |
| test_make_gradient_of_objective.R | 4 | 100% |
| test_make_log_hessian.R | 6 | 100% |

---

## CRAN Issues Fixed (1/2)

### DESCRIPTION Cleanup
- Removed `DisplayMode: Showcase` field
- Fixed Authors@R format
- Updated RoxygenNote to 7.3.3
- Added testthat edition 3

---

## CRAN Issues Fixed (2/2)

### URL Fixes
- Updated broken variancejournal.org links
- All documentation now uses working URLs

### LICENSE Fix
- Changed to proper DCF format
- Updated copyright years (2017-2026)

---

## Code Style Updates

### Line Length: 120 → 80 characters

Files reformatted:
- `R/chain.R`
- `R/make_log_hessian.R`

### .lintr Configuration
```yaml
linters: linters_with_defaults(
    line_length_linter(80),
    object_name_linter(styles = c("snake_case",
      "symbols", "camelCase", "dotted.case")),
    cyclocomp_linter(complexity_limit = 25)
  )
```

---

## R CMD check Results

### Final Status: **2 NOTEs** (No ERRORs or WARNINGs)

| NOTE | Description | Status |
|------|-------------|--------|
| 1 | New submission | Expected |
| 2 | HTML Tidy validation | System issue |

**Package is CRAN ready!**

---

## README Badges Added

```markdown
[![R-CMD-check](badge)](link)
[![R-CMD-check-scheduled](badge)](link)
[![License: MIT](badge)](link)
[![Lifecycle: experimental](badge)](link)
[![codecov](badge)](link)
```

All badges link to the stochasticreserver repository.

---

## GitHub Actions CI/CD

### 5 Automated Workflows

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| R-CMD-check | Push/PR | Multi-platform testing |
| R-CMD-check-scheduled | Monday 9:00 UTC | Catch dependency changes |
| test-coverage | Push/PR | Codecov reporting |
| pkgdown | Push/PR/Release | Documentation site |
| lint | Push/PR | Code quality |

---

## CI/CD Testing Matrix

### R-CMD-check runs on:

- **macOS** (latest) - R release
- **Windows** (latest) - R release
- **Ubuntu** (latest) - R devel, release, oldrel-1

All platforms must pass for merge.

---

## Codecov Integration

### Coverage Tracking

- **codecov.yml** configuration added
- Coverage precision: 2 decimal places
- Threshold: 1% tolerance
- PR comments show coverage diff

**Live dashboard:**
[app.codecov.io/gh/rmsharp/stochasticreserver](https://app.codecov.io/gh/rmsharp/stochasticreserver)

---

## Documentation Site

### pkgdown at GitHub Pages

**Features:**

- Automatic deployment on push
- Function reference organized by category
- Vignettes as Articles
- Code folding (custom JavaScript)
- Bootstrap 5 theme

**URL:** [rmsharp.github.io/stochasticreserver](https://rmsharp.github.io/stochasticreserver/)

---

## Comprehensive Tutorial

### All 5 Models Demonstrated

**Tutorial includes:**

- Theoretical framework from Hayne paper
- MLE properties and Fisher information
- All model mathematical forms
- Reserve comparison across models
- AIC/BIC model selection
- Residual diagnostics
- Monte Carlo simulation (5,000 iterations)

**Features:**

- Code folding - click to expand code blocks
- Linked reference to [Hayne paper](https://variancejournal.org/article/120823)

---

## Session Commits

### 8 Commits This Session

| Commit | Description |
|--------|-------------|
| faba7f4 | Comprehensive tests, CRAN fixes |
| 525b777 | Code folding JavaScript |
| 37161be | Tutorial code folding, chart fonts |
| 8dad67f | Codecov configuration |
| 000cd1f | Manual workflow trigger |
| 21f69eb | Documentation updates |
| 97ca37e | Split presentation slides |
| 4203a4f | Tutorial paper link |

---

## Files Modified

| Category | Files |
|----------|-------|
| Documentation | DESCRIPTION, LICENSE, README, NEWS |
| R Source | chain.R, make_log_hessian.R, data.R |
| Tests | 8 new + 2 updated |
| Config | .lintr, .Rbuildignore |
| Vignettes | _introduction.Rmd |

---

## Package Structure

```
stochasticreserver/
├── R/
│   ├── berquist.R, capecod.R, chain.R
│   ├── hoerl.R, wright.R
│   ├── make_*.R (3 files)
│   └── model_description.R
├── tests/testthat/
│   └── test_*.R (10 files)
├── vignettes/
├── inst/extdata/presentations/
└── DESCRIPTION, LICENSE, README
```

---

## Summary

### Package Transformation Complete

::: {.incremental}
- **Coverage:** 7% → 99%
- **Tests:** 4 → 85
- **NOTEs:** 6 → 2
- **Style:** Modern R best practices
- **Status:** CRAN Ready
:::

---

## Resources

### Package Links

- **Repository:** [github.com/rmsharp/stochasticreserver
](https://github.com/rmsharp/stochasticreserver)
- **Documentation:** [rmsharp.github.io/stochasticreserver
](https://rmsharp.github.io/stochasticreserver/)

### Reference

Hayne, R. "A Flexible Framework for Stochastic Reserving Models"
*Variance*, Vol 7, Issue 2

[variancejournal.org/article/120823](https://variancejournal.org/article/120823)

---

## Thank You

### Session documented in:

`INTERACTIONS_LOG.md`

All prompts and actions recorded for reproducibility.
